<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <link rel="icon" href="images/favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SVGcut</title>

  <link href="node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
  <link href="node_modules/bootstrap-slider/dist/css/bootstrap-slider.css"
        rel="stylesheet">
  <link href="css/SVGcut.css" rel="stylesheet">
  <script type="importmap">
    {
      "imports": {
        "gl-matrix/": "./node_modules/gl-matrix/esm/",
        "flatten-js": "./node_modules/@flatten-js/core/dist/main.mjs",
        "clipper-lib": "./node_modules/clipper-lib/clipper.js",
        "bezier-js": "./node_modules/bezier-js/src/bezier.js"
      }
    }
  </script>
  <script src="node_modules/knockout/build/output/knockout-latest.debug.js">
  </script>
  <script src="node_modules/knockout.validation/dist/knockout.validation.js">
  </script>
  <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
  <script src="node_modules/bootstrap-slider/dist/bootstrap-slider.js"></script>
  <script src="node_modules/clipper-lib/clipper.js"></script>
  <script src="node_modules/file-saver/dist/FileSaver.js"></script>
  <script type="module" src="./src/browser.js"></script>
</head>
<body>

  <div class="modal fade" id="SaveProjectModal" role="dialog"
       aria-labelledby="SpaModalTitle" aria-hidden="true">
    <!-- Bound to ProjectViewModel  -->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="SpaModalTitle">Save Project As</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="SpName">Name</label>
          <input id="SpName" data-bind="value:projectName" />
          <label for="SpTemplate">Template only</label>
          <input id="SpTemplate" type="checkbox"
                 data-bind="checked: templateOnly" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"
                  data-bind="click: saveProjectInBrowser, enabled: ">
            In Browser
          </button>
          <button type="button" class="btn btn-primary"
                  data-bind="click: saveProjectInFile">
            Local file
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="LoadProjectFromBrowserModal"
       role="dialog" aria-labelledby="LpfbModalTitle" aria-hidden="true">
    <!-- Bound to ProjectViewModel  -->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="LpfbModalTitle">Open Project</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p data-bind="text: getBrowserProjectsList()"></p>
          <p>Select Project:
            <select id="SelectProject"
                    data-bind="options:browserProjects,value:selectedProject">
            </select>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"
                  data-bind="click: gotoDeleteBrowserProject">
            Delete
          </button>
          <button type="button" class="btn btn-primary"
                  data-bind="click: loadProjectFromBrowser">
            Load
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="DeleteProjectFromBrowserModal"
       role="dialog" aria-labelledby="DpfbModalLabel" aria-hidden="true">
    <!-- Bound to ProjectViewModel  -->
    <div class="modal-dialog alert-danger">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="DpfbModalLabel">Delete Project</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Delete "<b><span data-bind="text: projectName"></span></b>"?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"
                  data-bind="click: deleteProjectFromBrowser">
            Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="SaveGcodeModal" role="dialog"
       aria-labelledby="SgcModalLabel" aria-hidden="true">
    <!-- Bound to GcodeGenerationViewModel -->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="SgcModalLabel">Save GCODE</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label>Save as</label>
          <input data-bind="value: gcodeFilename">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary"
                  data-bind="click: saveGcodeInFile">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="ViewGcodeModal" tabindex="-1" role="dialog"
       aria-hidden="true" arial-labelledby="VgcModalTitle">
    <!-- Bound to GcodeGenerationViewModel -->
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="VgcModalTitle">GCODE</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="GcodeTextView" data-bind="text: gcodeS">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="ConfirmDataLossModal" tabindex="-1" role="dialog"
       aria-hidden="true" arial-labelledby="CdlModalTitle">
    <!-- Bound to ProjectViewModel -->
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="CdlModalTitle">Confirm Data Loss</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Back"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you are happy to lose changes?</p>
          <button type="button" class="btn btn-primary"
                  data-bind="click: dataLossConfirmed">Yes</button>
          <button type="button" class="btn btn-primary"
                  data-bind="click: dataLossRejected">No</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container-fluid">
    <div class="row">

      <!-- left card column -->
      <div class="col-sm-3 sidebar-left">
        <div id="ProjectView">
          <!-- Bound to ProjectViewModel -->
          <span data-bind="text:projectChanged"></span>
          <span id="ProjectName" data-bind="text:projectName">New project</span>
        </div>
        <div class="card" id="OperationsView">
          <!-- Bound to OperationsViewModel -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#OperationsViewPane" class="nav-link">Operations</a>
            </h3>
          </div>
          <div id="OperationsViewPane" class="collapse show">
            <div class="card-body">
              <div style="display:inline-block">
                <button
                  id="CreateOperationButton" class="btn btn-primary manual-popover"
                  data-bind="click: addOperation, enable: App.models.Selection.isSomethingSelected()">
                  Create Operation
                </button>
              </div>
            </div> <!-- /card-body -->
            <div class="card-list">
              <div data-bind="foreach:{data:operations,afterRender:addSubview}">
                <!-- template for operations table row. Instances are
                     bound to OperationViewModel -->
                <div class="card-list-row">
                  <div class="card-list-cell expand">
                    <label data-bind="click:toggleDetail,text:showDetail() ? '&#x25bc;' : '&#x25b6;'">
                    </label>
                  </div>
                  <div class="card-list-cell enable">
                    <input id="OpEnabled" type="checkbox"
                           data-bind="checked: enabled"
                           class="auto-popover" />
                  </div>
                  <div class="card-list-cell">
                    <select id="OpOperation"
                            data-bind="options: availableOperations,optionsText:function(entry){return App.longOpName(entry);},value:operation"
                            class="auto-popover">
                    </select>
                  </div>
                  <div class="card-list-cell">
                    <input id="OpCutDepth" type="number" step="any" min="0"
                           data-bind="value: cutDepth"
                           class="auto-popover" />
                  </div>
                  <div class="card-list-cell">
                    <label class="control-label">
                      <span data-bind="text: App.models.Project.units"></span>
                    </label>
                  </div>
                </div> <!-- /card-list-row -->
                <table class="detail-table" data-bind="visible:showDetail">
                  <tr>
                    <td>
                      <label for="OpName" class="control-label">
                        Name
                      </label>
                    </td><td>
                      <input id="OpName" data-bind="value: name"
                             class="auto-popover" />
                    </td>
                  </tr>
                  <tr data-bind="visible:needs('ramp')">
                    <td>
                      <label for="OpRamp" class="control-label">
                        Ramp
                      </label>
                    </td><td>
                      <input id="OpRamp" type="checkbox"
                             data-bind="checked: ramp"
                             class="auto-popover" />
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label for="OpCombine" class="control-label">
                        Combine
                      </label>
                    </td><td>
                      <select id="OpCombine" data-bind="value:combineOp"
                              class="auto-popover">
                        <option value="Union">Union</option>
                        <option value="Intersect">Intersection</option>
                        <option value="Diff">Difference</option>
                        <option value="Xor">XOR</option>
                      </select>
                    </td>
                  </tr><tr data-bind="visible:needs('direction')">
                    <td>
                      <label for="OpDirection" class="control-label">
                        Direction
                      </label>
                    </td><td>
                      <select id="OpDirection"
                              data-bind="value: direction" class="auto-popover">
                        <option value="Conventional">Conventional</option>
                        <option value="Climb">Climb</option>
                      </select>
                    </td>
                  </tr><tr data-bind="visible:needs('spindleSpeed')">
                    <td>
                      <label for="OpSpindleSpeed" class="control-label">
                        Spindle
                      </label>
                    </td><td>
                      <input id="OpSpindleSpeed" type="number"
                             step="any" min="0"
                             data-bind="value: spindleSpeed"
                             class="auto-popover" />
                      rpm
                    </td>
                  </tr><tr data-bind="visible:needs('margin')">
                    <td>
                      <label for="OpMargin" class="control-label">
                        Margin
                      </label>
                    </td><td>
                      <input id="OpMargin" type="number"
                             step="any"
                             data-bind="value: margin"
                             class="auto-popover" />
                      <span data-bind="text: App.models.Project.units"></span>
                    </td>
                  </tr><tr data-bind="visible:needs('spacing')">
                    <td>
                      <label for="OpSpacing" class="control-label">
                        Spacing
                      </label>
                    </td><td>
                      <input id="OpSpacing" type="number"
                             step="any" min="0"
                             data-bind="value: spacing"
                             class="auto-popover" />
                      <span data-bind="text: App.models.Project.units"></span>
                    </td>
                  </tr>
                  <tr data-bind="visible:needs('width')">
                    <td>
                      <label for="OpWidth" class="control-label">
                        Width
                      </label>
                    </td><td>
                      <input id="OpWidth" type="number"
                             step="any" min="0"
                             data-bind="value: width"
                             class="auto-popover" />
                      <span data-bind="text: App.models.Project.units">
                      </span>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="2">
                      <button href="#"
                              class="btn btn-secondary btn-sm"
                              data-bind="click: removeOperation">
                        Delete Operation
                      </button>
                    </td>
                  </tr>
                </table> <!-- /detail-table -->
              </div> <!-- end of card-list template -->
            </div> <!-- /card-list -->
          </div> <!-- /OperationsViewPane -->
        </div> <!-- /OperationsView -->

        <div class="card" id="TabsView">
          <!-- Bound to TabsViewModel -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#TabsViewPane" class="nav-link">Holding Tabs</a>
            </h3>
          </div>
          <div id="TabsViewPane" class="collapse hide">
            <div class="card-body">
              <table class="card-table">
                <tr>
                  <td>
                    <label for="TabsMaxCutDepth" class="control-label">
                      Tab Depth</label>
                  </td>
                  <td>
                    <input id="TabsMaxCutDepth" type="number"
                           step="any" min="0"
                           data-bind="value: maxCutDepth"
                           class="auto-popover">
                    <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr>
              </table>
              <div style="display:inline-block">
                <button
                  id="CreateTabsButton" class="btn btn-primary manual-popover"
                  data-bind="click:addTab,enable:App.models.Selection.isSomethingSelected()">
                  Create Tabs
                </button>
              </div>
            </div> <!-- /card-body -->
            <div class="card-list">
              <div data-bind="foreach: {data:tabs,afterRender:addSubview}">
                <!-- template for Tabs table row. Instances are
                     bound to TabViewModel -->
                <div class="card-list-row">
                  <div class="card-list-cell enable">
                    <input id="TabEnabled" type="checkbox"
                           data-bind="checked: enabled" class="auto-popover" />
                  </div>
                  <div class="card-list-cell">
                    <input id="TabMargin" type="number" step="any" min="0"
                           data-bind="value: margin" class="auto-popover" />
                  </div>
                  <div class="card-list-cell">
                    <button class="btn btn-secondary btn-sm"
                            data-bind="click: removeTab">
                      Delete
                    </button>
                  </div>
                </div> <!-- /card-list-row -->
              </div> <!-- end of row template -->
            </div> <!-- /card-list -->
          </div> <!-- /TabsViewPane -->
        </div> <!-- /TabsView -->

        <div class="card" id="GcodeGenerationView">
          <!-- Bound to GcodeGenerationViewModel -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#GcodeGenerationViewPane" class="nav-link">
                Gcode Generation</a>
            </h3>
          </div>
          <div id="GcodeGenerationViewPane" class="collapse show">
            <div class="card-body">
              <table class="card-table">
                <tr>
                  <td>
                    <label for="GcodeUnits" class="control-label">
                      Units
                    </label>
                  </td><td colspan="2">
                    <select id="GcodeUnits" data-bind="value: units"
                            class="auto-popover">
                      <option>mm</option>
                      <option>inch</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="GcodeOrigin" class="control-label">
                      Origin
                    </label>
                  </td><td colspan="2">
                    <select id="GcodeOrigin" data-bind="value: origin"
                            class="auto-popover">
                      <option value="SVG page">SVG page</option>
                      <option value="Bounding box">Bounding box</option>
                      <option value="Centre">Centre</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="GcodeExtraOffsetX" class="control-label">
                      Origin Offset</label>
                  </td>
                  <td>
                    <input type="number" step="any"
                           id="GcodeExtraOffsetX"
                           data-bind="value: extraOffsetX"
                           class="auto-popover" />
                  </td>
                  <td>
                    <input type="number" step="any"
                           id="GcodeExtraOffsetY"
                           data-bind="value: extraOffsetY"
                           class="auto-popover" />
                  </td>
                </tr>
                <tr>
                  <td><label>Area</label></td>
                  <td id="GcodeWidth" data-bind="text: bbWidth"
                      class="auto-popover"></td>
                  <td id="GcodeHeight" data-bind="text: bbHeight"
                      class="auto-popover"></td>
                </tr>
                <tr>
                  <td colspan="2">
                    <label for="GcodeReturn00" class="control-label">
                      Finish at work origin</label>
                  </td>
                  <td>
                    <input id="GcodeReturn00" type="checkbox"
                           data-bind="checked: returnTo00"
                           class="auto-popover" />
                  </td>
                </tr>
              </table> <!-- /card-table -->
              <button class="btn btn-secondary btn-sm"
                      data-bind="enable: haveGcode(), click: viewGcode">
                View Gcode
              </button>
            </div> <!-- /card-body -->
          </div> <!-- /GcodeGenerationViewPane -->
        </div <!-- GcodeGenerationView -->
        <div id="AlertPlaceholder"></div>
      </div> <!-- /sidebar-left -->

      <!-- Middle column -->
      <div id="Middle" class="col-sm-6">
        <nav id="Toolbar" class="navbar navbar-expand-sm" role="navigation">
          <!-- Bound to ProjectViewModel -->
          <ul class="navbar-nav">
            <li class="nav-item dropdown navbar-collapse collapse">
              <a href="#"
                 class="nav-link dropdown-toggle"
                 id="ProjectDropdown"
                 data-bs-toggle="dropdown"
                 data-bs-auto-close="outside"
                 data-toggle="collapse"
                 aria-expanded="false">
                File<strong class="caret"></strong>
              </a>
              <ul class="dropdown-menu"
                  aria-labelledby="projectDropdown">
                <li class="dropdown-item">
                  <a href="#" class="nav-link close-on-click"
                     data-bind="click: newProject">
                    New Project
                  </a>
                </li>
                <li class="dropdown-item dropend">
                  <a href="#" id="OpenMenu" class="nav-link dropdown-toggle"
                     data-bs-toggle="dropdown" aria-expanded="false">
                    Open Project
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="OpenMenu">
                    <li class="dropdown-item">
                      <a href="#" class="nav-link close-on-click"
                         id="ChooseProjectFile">
                        ... from File
                        <input type="file" style="display:none"
                               accept=".svgcut" id="ChosenProjectFile">
                      </a>
                    </li><li class="dropdown-item">
                      <a href="#" class="nav-link close-on-click open-modal"
                         data-bind="click:()=>App.showModal('LoadProjectFromBrowserModal')">
                        ... from Browser
                      </a>
                    </li>
                  </ul>
                </li> <!-- /open submenu -->
                <li class="dropdown-item change-activated disabled">
                  <a href="#" class="nav-link close-on-click open-modal"
                     data-bind="click:()=> App.showModal('SaveProjectModal')">
                    Save Project
                  </a>
                </li>
                <li class="dropdown-item">
                  <a href="#" class="nav-link close-on-click"
                                     id="ChooseImportSVGFile">
                    Import SVG File
                    <input type="file" style="display:none"
                           accept=".svg,image/svg+xml"
                           id="ChosenImportSVGFile" multiple>
                  </a>
                </li>
                <li class="dropdown-item">
                  <a href="#" class="nav-link close-on-click open-modal"
                     data-bind="click:()=> App.showModal('SaveGcodeModal')">
                    Save Gcode
                  </a>
                </li>
              </ul> <!-- project menu -->
            </li> <!-- project toolbar item -->

            <li class="dropdown nav-item">
              <a href="#"
                 class="nav-link dropdown-toggle"
                 id="ViewDropdown"
                 data-bs-toggle="dropdown">
                View<strong class="caret"></strong>
              </a>
              <ul class="dropdown-menu" aria-labelledby="ViewDropdown">
                <li class="dropdown-item">
                  <a href="#" class="nav-link"
                     data-bind="click: App.zoomIn()">
                    Zoom In
                  </a>
                </li>
                <li class="dropdown-item">
                  <a href="#" class="nav-link"
                     data-bind="click: App.zoomOut()">
                    Zoom Out
                  </a>
                </li>
                <li class="dropdown-item">
                  <a href="#" class="nav-link"
                     data-bind="click: App.fitSVG()">
                    Fit
                  </a>
                </li>
                <li class="dropdown-item">
                  <a href="#" class="nav-link">
                    <input id="HideSVG" type="checkbox"
                           data-bind="checked: App.hideSVG()" />
                    <label for="HideSVG">Hide SVG</label>
                  </a>
                </li>
              </ul>
            </li> <!-- /view menu -->

            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle"
                 data-bs-toggle="dropdown">
                Units (<span id="PickedUnits">mm</span>)
                <strong class="caret"></strong>
              </a>
              <ul class="dropdown-menu">
                <li class="dropdown-item">
                  <a href="#" class="nav-link pickedUnits"
                     data-bind="click: () => units('mm')">
                    mm
                  </a>
                </li><li class="dropdown-item">
                  <a href="#" class="nav-link"
                     data-bind="click: () => units('inch')">
                    inch
                  </a>
                </li>
              </ul>
            </li>

            <li id="SelectionCounts" class="nav-item"
                style="display:table">
              <div style="display:table-row">
                <div style="display:table-cell">Selected paths:</div>
                <div style="display:table-cell"
                     data-bind="text: App.models.Selection.openSelected"></div>
                <div style="display:table-cell">open,</div>
                <div style="display:table-cell"
                     data-bind="text: App.models.Selection.closedSelected">
                </div>
                <div style="display:table-cell">closed</div>
              </div>
            </li>
          </ul>
        </nav> <!-- /Toolbar -->

        <!-- SVG views -->
        <div>
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a id="ActivateToolpathsTab" class="nav-link active" href="#SVGPanel"
                 data-bs-toggle="tab">
                Toolpaths
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#SimulatePanel" data-bs-toggle="tab">
                Simulate
              </a>
            </li>
          </ul>
          <div class="tab-content">
            <!-- toolpaths tab -->
            <div class="tab-pane active" id="SVGPanel">
              <svg id="MainSVG" viewBox="0 0 500 500"
                   preserveAspectRatio="xMinYMin meet">
                <defs>
                  <filter id="ContrastFilter" filterUnits="objectBoundingBox">
                    <feComponentTransfer>
                      <feFuncR type="linear" slope="0.5" intercept="0.25">
                      </feFuncR>
                      <feFuncG type="linear" slope="0.5" intercept="0.25">
                      </feFuncG>
                      <feFuncB type="linear" slope="0.5" intercept="0.25">
                      </feFuncB>
                    </feComponentTransfer>
                  </filter>
                </defs>
                <g id="ContentSVGGroup" class="managed-SVG-group serialisable"
                   filter="url(#ContrastFilter)"/>
                <g id="ToolPathsSVGGroup"
                   class="managed-SVG-group serialisable" />
                <g id="CombinedGeometrySVGGroup"
                   class="managed-SVG-group serialisable" />
                <g id="TabsSVGGroup" class="managed-SVG-group serialisable" />
                <g id="SelectionSVGGroup" class="managed-SVG-group" />
              </svg>
            </div>
            <!-- simulate tab -->
            <div class="tab-pane" id="SimulatePanel">
              <table width="100%">
                <tr>
                  <th>T:</th><td><span id="StopWatchT"></span>s</td>
                  <th>X:</th><td><span id="StopWatchX"></span></td>
                  <th>Y:</th><td><span id="StopWatchY"></span></td>
                  <th>Z:</th><td><span id="StopWatchZ"></span></td>
                  <th>F:</th><td><span id="StopWatchF"></span></td>
                  <th>S:</th><td><span id="StopWatchS"></span></td>
                </tr>
              </table>
              <input id="TimeControl" class="form-range" type="range"
                     max="1000" value="0" />
              <canvas id="SimulationCanvas"></canvas>
              <ul>
                <li>Use mouse to rotate view</li>
                <li>Use slider control to set simulation time</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- right -->
      <div class="col-sm-3 sidebar-right">

        <div class="card" id="ToolView">
          <!-- Bound to ToolViewModel -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#ToolViewPane" class="nav-link">
                Tool Settings</a>
            </h3>
          </div>
          <div id="ToolViewPane" class="collapse">
            <div class="card-body">
              <table class="card-table">
                <tr>
                  <td><label for="ToolDiameter" class="control-label">
                      Diameter</label>
                  </td><td>
                    <input id="ToolDiameter" type="number" step="any"
                           data-bind="value: diameter"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr>
                <!-- No support for angled bit
                <tr>
                  <td>
                    <label for="ToolAngle" class="control-label">
                      Angle</label>
                  </td><td>
                    <input id="ToolAngle" type="number"
                           step="any" min="1" max="180"
                           data-bind="value: angle"
                           class="auto-popover" /> &deg;
                  </td>
                </tr>
                -->
                <tr>
                  <td><label for="ToolPassDepth" class="control-label">
                      Pass Depth</label>
                  </td><td>
                    <input id="ToolPassDepth" type="number"
                           step="any" min="0"
                           data-bind="value: passDepth"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr><tr>
                  <td><label for="ToolStepOver" class="control-label">
                      Step Over</label>
                  </td><td>
                    <input id="ToolStepOver" type="number"
                           step="any" min="0" max="1"
                           data-bind="value: stepover"
                           class="auto-popover"> [0..1]
                  </td>
                </tr><tr>
                  <td><label for="ToolRapidRate" class="control-label">
                      Rapid</label>
                  </td><td>
                    <input id="ToolRapidRate" type="number"
                           step="any" min="0"
                           data-bind="value: rapidRate"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>/min
                  </td>
                </tr><tr>
                  <td><label for="ToolPlungeRate" class="control-label">
                      Plunge</label>
                  </td><td>
                    <input id="ToolPlungeRate" type="number"
                           step="any" min="0"
                           data-bind="value: plungeRate"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>/min
                  </td>
                </tr>
                <tr>
                  <td><label for="ToolCutRate" class="control-label">
                      Cut</label>
                  </td><td>
                    <input id="ToolCutRate" type="number"
                           step="any" min="0"
                           data-bind="value: cutRate"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>/min
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>

        <div class="card" id="MaterialView">
          <!-- Bound to MaterialViewModel -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#MaterialViewPane" class="nav-link">
                Material
              </a>
            </h3>
          </div>
          <div id="MaterialViewPane" class="collapse">
            <div class="card-body">
              <div class="form-horizontal">
                <div class="mb-3">
                  <div class="col-sm-10">
                    <svg id="MaterialSVG" class="autoheight"
                         viewBox="0 0 74 35" internalWidth="74"
                         internalHeight="35" src="images/Material.svg" />
                  </div>
                </div>
              </div>
              <table class="card-table">
                <tr>
                  <td>
                    <label for="InputMatThickness" class="control-label">
                      Thickness</label>
                  </td><td>
                    <input type="number" step="any" id="InputMatThickness"
                           data-bind="value: thickness"
                           placeholder="Thickness"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr><tr>
                  <td>
                    <label for="SelectMatZOrigin" class="control-label">
                      Z Origin</label>
                  </td><td>
                    <select id="SelectMatZOrigin" data-bind="value: zOrigin"
                            class="auto-popover">
                      <option value="Top">Top</option>
                      <option value="Bottom">Bottom</option>
                    </select>
                  </td>
                </tr><tr>
                  <td>
                    <label for="InputMatClearance" class="control-label">
                      Clearance</label>
                  </td><td>
                    <input type="number" step="any" id="InputMatClearance"
                           data-bind="value: clearance"
                           placeholder="Clearance"
                           class="auto-popover" />
                    <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>

        <div class="card" id="CurveConversionView">
          <!-- Bound to CurveConversionViewModel  -->
          <div class="card-header">
            <h3 class="card-title">
              <a data-bs-toggle="collapse"
                 href="#CurveConversionViewPane" class="nav-link">
                Curve To Line Conversion
              </a>
            </h3>
          </div>
          <div id="CurveConversionViewPane" class="collapse">
            <div class="card-body">
              <table class="card-table">
                <tr>
                  <td>
                    <label for="InputMinNumSegments" class="control-label">
                      Minimum Segments</label>
                  </td><td colspan="2">
                    <input type="number" id="InputMinNumSegments"
                           data-bind="value: minSegs"
                           placeholder="Segments" class="auto-popover" />
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="InputMinSegmentLength" class="control-label">
                      Minimum Segment Length
                    </label>
                  </td><td>
                    <input type="number" step="any"
                           id="InputMinSegmentLength"
                           data-bind="value: minSegLen"
                           placeholder="Length" class="auto-popover" />
                  </td><td>
                      <span data-bind="text: App.models.Project.units"></span>
                  </td>
                </tr>
              </table> <!-- /card-table -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-none">
    <!-- Text strings; kept here to contain translation to just the HTML -->
    <div id="TutorialSteps">
      <span name="Step1">Open the File menu and import one or more SVG files.</span>
      <span name="Step2">Click 1 or more paths</span>
      <span name="Step3">Click "Create Operation" after you have finished selecting paths.</span>
      <span name="Step4">You're done! Look at the "Simulate" tab. View your Gcode with "View Gcode". Customise the operation to your tastes. Save your gcode.</span>
    </div>
    <div id="Popovers" style="display:none">
      <span name="SelectProject">Select a project stored in this browser</span>
      <!-- Tool -->
      <span name="ToolUnits">Display units, does not affect Gcode generation</span>
      <span name="ToolDiameter">Diameter of cutter. For a V cutter, diameter of the widest part of the bit.</span>
      <span name="ToolAngle">Angle of tapered cutter head. This is the angle
        at the tip of the tool, so 180 means a flat bottom tool, while 90
        means a 45&deg; chamfer bit.</span>
      <span name="ToolPassDepth">Maximum depth the tool should plunge each pass.
        Use a smaller pass depth for harder materials and better quality.
        Pass depth should never exceed the height of the cutting surface
        on the tool</span>
      <span name="ToolStepOver">
        What fraction of the tool diameter the tool should step over each
        time around a loop. Smaller values produce better cuts and reduce
        tool wear, but take longer to complete</span>
      <span name="ToolRapidRate">
        The speed the tool moves while not cutting</span>
      <span name="ToolPlungeRate">
        The speed the tool plunges downwards into the material</span>
      <span name="ToolCutRate">
        The speed the tool moves horizontally during cutting</span>
      <!-- Tabs -->
      <span name="CreateTabsButton"><p class='bg-danger'>
          Select one or more paths in the "Toolpaths" pane before clicking
          here</p></span>
      <span name="TabEnabled">Enable/disable this holding tab</span>
      <div name="TabMargin">Margin<br>+ve: how much to expand tab<br>
        -ve: how much to shrink tab</div>
      <span name="TabsMaxCutDepth">Maximum depth operations may cut when
        they pass over holding tabs</span>
      <!-- Gcode Generation -->
      <span name="GcodeUnits">
        The units used by the machine the Gcode is targeted for. The Gcode
        will try to switch the machine into these units using G20/G21, so
        you should only need to change this if the machine doesn't support
        these codes (or you are more comfortable thinking in inches!)
      </span>
      <span name="GcodeOrigin">
        Set the machine origin. "SVG page" will set (0,0) to the bottom
        left of the SVG page. "Bounding box" will set it to the bottom left
        of the bounding box around the toolpaths. "Centre" will set it to
        the middle of the toolpaths. Choose the origin that works best
        with your CNC machine.
      </span>
      <span name="GcodeExtraOffsetX">
        Extra X offset added to the the machine origin</span>
      <span name="GcodeExtraOffsetY">
        Extra Y offset added to the machine origin</span>
      <span name="GcodeWidth">Width of the work</span>
      <span name="GcodeHeight">Height of the work</span>
      <span name="GcodeReturn00">Move the tool to 0,0 after the last
        operation</span>
      <!-- Material -->
      <span name="InputMatThickness">How thick is the material</span>
      <span name="SelectMatZOrigin">Where Z=0 is</span>
      <span name="InputMatClearance">How high the tool moves over the material.
        Increase this when using clamps or screws to fasten the material</span>
      <!-- Operation -->
      <span name="CreateOperationButton"><p class='bg-danger'>
          Select one or more objects in the "Toolpaths" tab before clicking
          here</p></span>
      <span name="OpEnabled">Enable/disable this operation. Only enabled operation are shown</span>
      <span name="OpName">Name used in gcode comments</span>
      <span name="OpRamp">Ramp the cutter in gradually instead of plunging straight down</span>
      <span name="OpCombine">How to combine multiple paths into this operation</span>
      <span name="OpDirection">What direction the cutter should travel.
        See README for an explanation</span>
      <span name="OpSpindleSpeed">How fast the spindle should run while
        completing this operation</span>
      <span name="OpCutDepth">How deep this operation should cut in total</span>
      <div name="OpOperation">Operation to perform on the selected paths.
        <ul>
          <li><em>Engrave</em> - middle of the tool follows the paths</li>
          <li><em>Inside</em> - cuts around the inside of closed paths</li>
          <li><em>Outside</em> - cuts around the outside of closed paths</li>
          <li><em>Perforate</em> - drills holes around the outside of closed paths, or along open paths</li>
          <li><em>Pocket (annular)</em> - carves a pocket using annular rings (closed paths only)</li>
          <li><em>Pocket (raster</em>) - carves a pocket using side-to-side movement (closed paths only)</li>
          <li><em>Drill</em> - drills a hole at each vertex of the path</li>
        </ul>
      </div>
      <span name="OpVMaxDepth">Maximum depth this operation should cut.
        <p class="bg-danger">not implemented yet; this is ignored</p></span>
      <div name="OpMargin">
        <p>Positive: how much material to leave uncut</p>
        <p>Negative: how much extra material to cut</p></div>
      <div name="OpSpacing">
        How much material to leave uncut between perforations</div>
      <span name="OpWidth">How wide a path to cut. If this is less than the
        cutter width then it uses the cutter width</span>
      <!-- Selection -->
      <span name="InputMinNumSegments">Minimum number of line segments
        to convert a curve to. Curve conversion is done when something
        with a curve in it is selected.</span>
      <span name="InputMinSegmentLength">Minimum length of each line segment
        when converting curves. Curve conversion is done when something
        with a curve in it is selected.</span>
    </div>
    <div id="Alerts">
      <span name="tabsDeeper">Holding tabs are cut deeper than the max cut depth and will be ignored</span>
      <span name="loadingProject">Loading project "$1"</span>
      <span name="loadedProject">Loaded project "$1"</span>
      <span name="projectLoadAbort">Aborted reading project "$1"</span>
      <span name="projectLoadError">Error reading project "$1"</span>
      <span name="projectSavedInBrowser">"$1" saved in the browser</span>
      <span name="projectNotInBrowser">Project "$1" not found in the browser</span>
      <span name="passDepthTooSmall">Pass depth $1 &lt; 0. Will be set to 0</span>
      <span name="cutDepthTooSmall">Operation "$1" has a cut depth which is &lt; 0. Will reset to 0</span>
      <span name="noToolPaths">Operation "$1" doesn't generate any tool paths. Check that features are wider than the tool diameter</span>
      <span name="loadingSVG">Loading SVG from $1</span>
      <span name="loadedSVG">Loaded SVG from $1</span>
      <span name="svgLoadAbort">Aborted reading $1</span>
      <span name="svgLoadError">Error reading $1</span>
      <span name="tutorialStep">Step $1: $2</span>
      <span name="tabsMustBeClosed">At least one closed path must be selected to create tabs</span>
    </div>
  </div>
</body>
</html>
